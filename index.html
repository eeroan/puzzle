<body>
<script>
  Object.assign(new Image(), {
    src:    'image.png',
    onload: ({target: image}) => {
      const {width, height} = image
      const ctx = createContext()
      ctx.drawImage(image, 0, 0)
      const pixels = partition(ctx.getImageData(0, 0, width, height).data, 4).map(rgbaToAction)
      const matrix = partition(pixels, width)
      ctx.fillRect(0, 0, width, height)
      matrix.forEach((row, y) =>
        row.forEach((cell, x) =>
          cell.match('^move(Left|Up)$') && startVector(ctx, matrix, x, y)))
    }
  })
  const createContext = () => {
    const canvas = document.createElement('canvas')
    document.body.appendChild(canvas)
    return Object.assign(canvas.getContext('2d'), {strokeStyle: 'red', fillStyle: 'white', lineWidth: 2})
  }
  const startVector = (ctx, matrix, x, y) => {
    ctx.beginPath()
    ctx.moveTo(x, y)
    drawVector(ctx, matrix, {x, y})
  }
  const drawVector = (ctx, matrix, {x, y}, oldDirection) => {
    const action = matrix[y][x]
    const vectorEnd = !action.match('move')
    if (vectorEnd) {
      ctx.lineTo(x, y)
      ctx.stroke()
    }
    if (action === 'stop') {
      ctx.closePath()
    } else {
      const direction = nextDirection(oldDirection, action) || oldDirection
      drawVector(ctx, matrix, nextPosition({x, y}, direction), direction)
    }
  }
  const partition = (arr, chunkSize) => Array.from(Array(arr.length / chunkSize)).map((_, i) => arr.slice(i * chunkSize, (i + 1) * chunkSize))
  const rgbaToAction = rgba => ({
    '7,84,19,255':     'moveUp',
    '139,57,137,255':  'moveLeft',
    '51,69,169,255':   'stop',
    '182,149,72,255':  'turnRight',
    '123,131,154,255': 'turnLeft'
  }[rgba.join(',')] || 'moveForward')
  const nextDirection = (direction, action) => ({
    'turnRight': direction % 4 + 1,
    'turnLeft':  (direction + 2) % 4 + 1,
    'moveUp':    1,
    'moveLeft':  4
  }[action])
  const nextPosition = ({x, y}, direction) => ({
    1: {x, y: y - 1}, // UP
    2: {x: x + 1, y}, // RIGHT
    3: {x, y: y + 1}, // DOWN
    4: {x: x - 1, y}  // LEFT
  }[direction])
</script>
