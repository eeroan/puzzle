<!DOCTYPE html>
<html>
<head>
    <title>Puzzle</title>
    <meta charset="utf-8"/>
</head>
<body>
<pre>
Ala piirtää ylöspäin, kun pikselin väri on 7, 84, 19.
Ala piirtää vasemmalle, kun pikselin väri on 139, 57, 137.
Lopeta viivan piirtäminen, kun pikselin väri on 51, 69, 169.
Käänny oikealle, kun pikselin väri on 182, 149, 72.
Käänny vasemmalle, kun pikselin väri on 123, 131, 154.
</pre>
<canvas id="canvas" width="180" height="60"></canvas>
<script>
  const width = 180
  const height = 60
  let matrix
  let ctx
  const action = rgba => {
    if (rgbEquals(rgba, [7, 84, 19])) return 'up'
    else if (rgbEquals(rgba, [139, 57, 137])) {
      return 'left'
    } else if (rgbEquals(rgba, [51, 69, 169])) {
      return 'stop'
    } else if (rgbEquals(rgba, [182, 149, 72])) {
      return 'turnRight'
    } else if (rgbEquals(rgba, [123, 131, 154])) {
      return 'turnLeft'
    } else {
      return null
    }
  }
  const rgbEquals = (rgba, rgb) =>
  rgba[0] == rgb[0] &&
  rgba[1] == rgb[1] &&
  rgba[2] == rgb[2]

  const partition = (arr, chunk) => {
    const newArr = []
    for (let i = 0, j = arr.length; i < j; i += chunk) {
      newArr.push(arr.slice(i, i + chunk))
    }
    return newArr
  }

  const penDown = (x, y) => {
    ctx.beginPath()
    ctx.moveTo(x, y)
  }
  const drawLineTo = (x, y) => {
    ctx.lineTo(x, y)
    ctx.stroke()
  }
  const stopLine = (x, y) => {
    drawLineTo(x, y)
    ctx.closePath()
  }

  const upWhile = (xStart, yStart) => {
    drawLineTo(xStart, yStart)
    for (let y = yStart; y > 0; y--) {
      let pixel = matrix[y][xStart]
      if (pixel === 'stop' || y === 0) return stopLine(xStart, y)
    }
  }

  const myImg = new Image()
  myImg.src = 'image.png'
  myImg.onload = () => {
    ctx = document.getElementById('canvas').getContext('2d')
    with (ctx) {
      drawImage(myImg, 0, 0)
      strokeStyle = "rgba(255, 0, 0, 1.0)"
      lineWidth = 1
      lineCap = "round"

    }

    const data = Array.from(ctx.getImageData(0, 0, width, height).data)
    console.log(data.length)
    const pixels = partition(data, 4).map(action)
    matrix = partition(pixels, width)
    window.matrix = matrix
    for (let y = 0; y < height-1; y++) {
      for (let x = 0; x < width-1; x++) {
        const pixel = matrix[y][x]
        if (pixel) {
          if (pixel === 'up') {
            penDown(x, y)
            upWhile(x, y)
          }
        }
      }
    }
  }
</script>
</body>
</html>
